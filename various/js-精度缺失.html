<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>精度丢失 | 只道寻常的前端小站点</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/assets/logo.svg">
    <meta name="description" content="一些笔记和生活杂谈">
    
    <link rel="preload" href="/assets/css/0.styles.a7ac0671.css" as="style"><link rel="preload" href="/assets/js/app.30386755.js" as="script"><link rel="preload" href="/assets/js/2.1d87707d.js" as="script"><link rel="preload" href="/assets/js/32.4ba9178d.js" as="script"><link rel="prefetch" href="/assets/js/10.f187c38e.js"><link rel="prefetch" href="/assets/js/11.a2cfd7d3.js"><link rel="prefetch" href="/assets/js/12.172a03c8.js"><link rel="prefetch" href="/assets/js/13.1b18bfcf.js"><link rel="prefetch" href="/assets/js/14.743ab3bd.js"><link rel="prefetch" href="/assets/js/15.82ffff1b.js"><link rel="prefetch" href="/assets/js/16.ee1bfe61.js"><link rel="prefetch" href="/assets/js/17.eb3d4a5a.js"><link rel="prefetch" href="/assets/js/18.9bcac279.js"><link rel="prefetch" href="/assets/js/19.f5e0e05a.js"><link rel="prefetch" href="/assets/js/20.b2e6d5c9.js"><link rel="prefetch" href="/assets/js/21.3786092e.js"><link rel="prefetch" href="/assets/js/22.371ac28b.js"><link rel="prefetch" href="/assets/js/23.5fc3bec3.js"><link rel="prefetch" href="/assets/js/24.606fb208.js"><link rel="prefetch" href="/assets/js/25.94e0f4d3.js"><link rel="prefetch" href="/assets/js/26.69ba41cd.js"><link rel="prefetch" href="/assets/js/27.6d837a58.js"><link rel="prefetch" href="/assets/js/28.dff1ab47.js"><link rel="prefetch" href="/assets/js/29.21117ab2.js"><link rel="prefetch" href="/assets/js/3.06ac1e4a.js"><link rel="prefetch" href="/assets/js/30.b02ee247.js"><link rel="prefetch" href="/assets/js/31.b0d15d1e.js"><link rel="prefetch" href="/assets/js/33.f3a5e69f.js"><link rel="prefetch" href="/assets/js/34.2c62ff95.js"><link rel="prefetch" href="/assets/js/35.f6783a61.js"><link rel="prefetch" href="/assets/js/36.755b9357.js"><link rel="prefetch" href="/assets/js/37.960d1695.js"><link rel="prefetch" href="/assets/js/38.9e782115.js"><link rel="prefetch" href="/assets/js/39.91e5aa93.js"><link rel="prefetch" href="/assets/js/4.71ddf4d5.js"><link rel="prefetch" href="/assets/js/40.61d90dc9.js"><link rel="prefetch" href="/assets/js/41.d13d89c2.js"><link rel="prefetch" href="/assets/js/42.52a32d49.js"><link rel="prefetch" href="/assets/js/43.6ea71cec.js"><link rel="prefetch" href="/assets/js/44.fffc6cae.js"><link rel="prefetch" href="/assets/js/45.c33098d6.js"><link rel="prefetch" href="/assets/js/46.38c1b29f.js"><link rel="prefetch" href="/assets/js/47.6a79485a.js"><link rel="prefetch" href="/assets/js/48.788c6504.js"><link rel="prefetch" href="/assets/js/49.50833b53.js"><link rel="prefetch" href="/assets/js/5.8ef9cb65.js"><link rel="prefetch" href="/assets/js/50.d5e85ab5.js"><link rel="prefetch" href="/assets/js/6.44cd9b24.js"><link rel="prefetch" href="/assets/js/7.8d0fa6a7.js"><link rel="prefetch" href="/assets/js/8.3995213f.js"><link rel="prefetch" href="/assets/js/9.c0b846a1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a7ac0671.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">只道寻常的前端小站点</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/factory/" class="nav-link">
  项目开发好用工具
</a></div><div class="nav-item"><a href="/optimization/" class="nav-link">
  优化方案集
</a></div><div class="nav-item"><a href="/tags/" class="nav-link">
  标签
</a></div><div class="nav-item"><a href="/vue/" class="nav-link">
  vue不间断更新
</a></div><div class="nav-item"><a href="/various/" class="nav-link router-link-active">
  杂七杂八的文章
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/factory/" class="nav-link">
  项目开发好用工具
</a></div><div class="nav-item"><a href="/optimization/" class="nav-link">
  优化方案集
</a></div><div class="nav-item"><a href="/tags/" class="nav-link">
  标签
</a></div><div class="nav-item"><a href="/vue/" class="nav-link">
  vue不间断更新
</a></div><div class="nav-item"><a href="/various/" class="nav-link router-link-active">
  杂七杂八的文章
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>杂七杂八的文章</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/various/ vue-打开网站页面时判断若未登录自动跳转到登录页.html" class="sidebar-link">打开网站页面时判断若未登录自动跳转到登录页</a></li><li><a href="/various/2022-03-02-homebrew安装及问题记录.html" class="sidebar-link">homebrew安装过程及问题记录</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/various/2022-03-03-博客搭建不完全记录.html" class="sidebar-link">博客搭建不完全记录</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/various/2022-03-03-博客搭建不完全记录.html#一、使用的插件" class="sidebar-link">一、使用的插件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/various/2022-03-03-博客搭建不完全记录.html#_1-头部-nav-导航栏自动生成" class="sidebar-link">1. 头部 nav 导航栏自动生成</a></li><li class="sidebar-sub-header"><a href="/various/2022-03-03-博客搭建不完全记录.html#_2-侧边栏-navbar-自动生成" class="sidebar-link">2. 侧边栏 navbar 自动生成</a></li><li class="sidebar-sub-header"><a href="/various/2022-03-03-博客搭建不完全记录.html#_3-文件中文命名在路径链接中转为拼音显示" class="sidebar-link">3. 文件中文命名在路径链接中转为拼音显示</a></li><li class="sidebar-sub-header"><a href="/various/2022-03-03-博客搭建不完全记录.html#_4-加载进度条显示" class="sidebar-link">4.加载进度条显示</a></li></ul></li><li class="sidebar-sub-header"><a href="/various/2022-03-03-博客搭建不完全记录.html#二、-markdown-文件中的配置说明" class="sidebar-link">二、 markdown 文件中的配置说明</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/various/2022-03-03-博客搭建不完全记录.html#_1-title-文章大标题" class="sidebar-link">1. title: 文章大标题</a></li><li class="sidebar-sub-header"><a href="/various/2022-03-03-博客搭建不完全记录.html#_2-displayallheaders-true" class="sidebar-link">2. displayAllHeaders: true</a></li><li class="sidebar-sub-header"><a href="/various/2022-03-03-博客搭建不完全记录.html#_3-sidebardepth" class="sidebar-link">3. sidebarDepth</a></li><li class="sidebar-sub-header"><a href="/various/2022-03-03-博客搭建不完全记录.html#_4-autoignore-true" class="sidebar-link">4. autoIgnore: true</a></li><li class="sidebar-sub-header"><a href="/various/2022-03-03-博客搭建不完全记录.html#_5-autonav" class="sidebar-link">5. autonav</a></li></ul></li></ul></li><li><a href="/various/2022-03-04-blog-todo.html" class="sidebar-link">待办事项</a></li><li><a href="/various/2022-03-07-git常用命令.html" class="sidebar-link">git 常用命令</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/various/2022-03-07-npm日常使用.html" class="sidebar-link">2022-03-07-npm日常使用</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/various/2022-03-11-npm报错记录.html" class="sidebar-link">!image</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/various/2022-03-11-python升级.html" class="sidebar-link">python升级</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/various/2022-03-11-rxjs.html" class="sidebar-link">rxjs常用语法记录</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/various/2022-03-11-好文章请看这.html" class="sidebar-link">好文章请看这里</a></li><li><a href="/various/antd vue组件问题.html" class="sidebar-link">/various/antd vue组件问题.html</a></li><li><a href="/various/babel-polyfill——解决Vue2+Webpack+ES6 兼容低版本浏览器（IE9）.html" class="sidebar-link">/various/babel-polyfill——解决Vue2+Webpack+ES6 兼容低版本浏览器（IE9）.html</a></li><li><a href="/various/css攻略——flex布局.html" class="sidebar-link">flex 布局</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/various/css攻略——flex布局.html#flex-布局" class="sidebar-link">flex 布局</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/various/css攻略——flex布局.html#_1-老版本-flex-display-box" class="sidebar-link">1. 老版本 flex（display: box）</a></li><li class="sidebar-sub-header"><a href="/various/css攻略——flex布局.html#_2-新版本-flex-display-flex" class="sidebar-link">2. 新版本 flex（display: flex）</a></li></ul></li></ul></li><li><a href="/various/git-git-ssh key配置.html" class="sidebar-link">配置ssh</a></li><li><a href="/various/js-jasmine测试语法.html" class="sidebar-link">jest测试常用语法</a></li><li><a href="/various/js-rxjs常用语法.html" class="sidebar-link">rxjs常用操作</a></li><li><a href="/various/js-常用正则.html" class="sidebar-link">常用正则表达式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/various/js-常用正则.html#常用正则表达式" class="sidebar-link">常用正则表达式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/various/js-常用正则.html#一、校验数字的表达式" class="sidebar-link">一、校验数字的表达式</a></li><li class="sidebar-sub-header"><a href="/various/js-常用正则.html#二、校验字符的表达式" class="sidebar-link">二、校验字符的表达式</a></li><li class="sidebar-sub-header"><a href="/various/js-常用正则.html#三、特殊需求表达式" class="sidebar-link">三、特殊需求表达式</a></li></ul></li></ul></li><li><a href="/various/js-浏览器渲染原理.html" class="sidebar-link">浏览器渲染核心</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/various/js-浏览器渲染原理.html#差异" class="sidebar-link">差异：</a></li><li class="sidebar-sub-header"><a href="/various/js-浏览器渲染原理.html#总结" class="sidebar-link">总结：</a></li></ul></li><li><a href="/various/js-精度缺失.html" class="active sidebar-link">精度丢失</a></li><li><a href="/various/js-输入框之表情替换.html" class="sidebar-link">输入框之表情替换</a></li><li><a href="/various/mac安装软件常遇问题“xx”已损坏，无法打开，你应将它移废纸蒌.html" class="sidebar-link">macOS遇见的问题</a></li><li><a href="/various/path.resolve和path.join的区别.html" class="sidebar-link">path.resolve和path.join的区别.md</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/various/vscode-vue模板语法.html" class="sidebar-link">在 vscode 中设置模板语法，可以直接使用“vue + 回车键”创 vue 文件中的 vue 内容</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/various/vscode-vue模板语法.html#在-vscode-中设置模板语法-可以直接使用-vue-回车键-创-vue-文件中的-vue-内容" class="sidebar-link">在 vscode 中设置模板语法，可以直接使用“vue + 回车键”创 vue 文件中的 vue 内容</a></li></ul></li><li><a href="/various/vscode-使用eslint-未完成.html" class="sidebar-link">安装vscode中eslint的插件</a></li><li><a href="/various/vscode-快捷键使用.html" class="sidebar-link">vscode操作指南</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/various/vscode-快捷键使用.html#vscode操作指南" class="sidebar-link">vscode操作指南</a></li></ul></li><li><a href="/various/vscode新建token.html" class="sidebar-link">vscode中github新建token</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/various/vscode新建token.html#vscode中github新建token" class="sidebar-link">vscode中github新建token</a></li></ul></li><li><a href="/various/vue-响应式和diff算法.html" class="sidebar-link">2.0虚拟DOM</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/various/vue-响应式和diff算法.html#_2-0虚拟dom" class="sidebar-link">2.0虚拟DOM</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/various/vue-响应式和diff算法.html#虚拟dom的概念" class="sidebar-link">虚拟dom的概念</a></li><li class="sidebar-sub-header"><a href="/various/vue-响应式和diff算法.html#优点" class="sidebar-link">优点</a></li><li class="sidebar-sub-header"><a href="/various/vue-响应式和diff算法.html#实现" class="sidebar-link">实现</a></li></ul></li><li class="sidebar-sub-header"><a href="/various/vue-响应式和diff算法.html#vue3-0的虚拟dom" class="sidebar-link">Vue3.0的虚拟DOM</a></li></ul></li><li><a href="/various/vue项目配置icon和webapk链式操作.html" class="sidebar-link">vue 项目配置 icon 和 webapk 链式操作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/various/vue项目配置icon和webapk链式操作.html#vue-项目配置-icon-和-webapk-链式操作" class="sidebar-link">vue 项目配置 icon 和 webapk 链式操作</a></li></ul></li><li><a href="/various/命令行使用——git常用命令.html" class="sidebar-link">git常用命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/various/命令行使用——git常用命令.html#git常用命令" class="sidebar-link">git常用命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/various/命令行使用——git常用命令.html#查看本地所有分枝" class="sidebar-link">查看本地所有分枝</a></li><li class="sidebar-sub-header"><a href="/various/命令行使用——git常用命令.html#查看远程所有分支" class="sidebar-link">查看远程所有分支</a></li><li class="sidebar-sub-header"><a href="/various/命令行使用——git常用命令.html#_2-拉取本地没有的远程分支" class="sidebar-link">2. 拉取本地没有的远程分支</a></li><li class="sidebar-sub-header"><a href="/various/命令行使用——git常用命令.html#_3-提交修改并推送到远程分支" class="sidebar-link">3. 提交修改并推送到远程分支</a></li><li class="sidebar-sub-header"><a href="/various/命令行使用——git常用命令.html#删除本地分支" class="sidebar-link">删除本地分支</a></li><li class="sidebar-sub-header"><a href="/various/命令行使用——git常用命令.html#删除本地全部分支" class="sidebar-link">删除本地全部分支</a></li><li class="sidebar-sub-header"><a href="/various/命令行使用——git常用命令.html#获取某次提交的代码" class="sidebar-link">获取某次提交的代码</a></li><li class="sidebar-sub-header"><a href="/various/命令行使用——git常用命令.html#git-stash-的使用" class="sidebar-link">git stash 的使用</a></li><li class="sidebar-sub-header"><a href="/various/命令行使用——git常用命令.html#打tag标签" class="sidebar-link">打tag标签</a></li></ul></li></ul></li><li><a href="/various/命令行使用——配置环境变量.html" class="sidebar-link">mac中host配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/various/命令行使用——配置环境变量.html#mac中host配置" class="sidebar-link">mac中host配置</a></li></ul></li><li><a href="/various/图床的使用-代替其他网盘之类的存储个人图片.html" class="sidebar-link">/various/图床的使用-代替其他网盘之类的存储个人图片.html</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/various/图床的使用-代替其他网盘之类的存储个人图片.html#ghp-5z5t1ubso9tgqxnqpizbbhk1zkoy9h4fbxsr" class="sidebar-link">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</a></li></ul></li><li><a href="/various/工具使用-有道云笔记中引入图片.html" class="sidebar-link">1. 将图片存储到有道云中</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/various/工具使用-有道云笔记中引入图片.html#_1-将图片存储到有道云中" class="sidebar-link">1. 将图片存储到有道云中</a></li><li class="sidebar-sub-header"><a href="/various/工具使用-有道云笔记中引入图片.html#_2-将分享的图片地址复制下来" class="sidebar-link">2. 将分享的图片地址复制下来</a></li></ul></li><li><a href="/various/日常零碎内容整理.html" class="sidebar-link">/various/日常零碎内容整理.html</a></li><li><a href="/various/跨域——access-control-allow-XX设置 跨域资源共享cors详解,promise,.html" class="sidebar-link">access-control-allow-origin的设置</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * floatObj 包含加减乘除四个方法，能确保浮点数运算不丢失精度
 *
 * 我们知道计算机编程语言里浮点数计算会存在精度丢失问题（或称舍入误差），其根本原因是二进制和实现位数限制有些数无法有限表示
 * 以下是十进制小数对应的二进制表示
 *      0.1 &gt;&gt; 0.0001 1001 1001 1001…（1001无限循环）
 *      0.2 &gt;&gt; 0.0011 0011 0011 0011…（0011无限循环）
 * 计算机里每种数据类型的存储是一个有限宽度，比如 JavaScript 使用 64 位存储数字类型，因此超出的会舍去。舍去的部分就是精度丢失的部分。
 *
 * ** method **
 *  add / subtract / multiply /divide
 *
 * ** explame **
 *  0.1 + 0.2 == 0.30000000000000004 （多了 0.00000000000004）
 *  0.2 + 0.4 == 0.6000000000000001  （多了 0.0000000000001）
 *  19.9 * 100 == 1989.9999999999998 （少了 0.0000000000002）
 *
 *  &gt;&gt; 0.3
 * floatObj.multiply(19.9, 100) &gt;&gt; 1990
 *
 */</span>
<span class="token keyword">var</span> floatObj <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/*
   * 判断obj是否为一个整数
   */</span>
  <span class="token keyword">function</span> <span class="token function">isInteger</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">===</span> obj
  <span class="token punctuation">}</span>

  <span class="token comment">/*
   * 将一个浮点数转成整数，返回整数和倍数。如 3.14 &gt;&gt; 314，倍数是 100
   * @param floatNum {number} 小数
   * @return {object}
   *   {times:100, num: 314}
   */</span>
  <span class="token keyword">function</span> <span class="token function">toInteger</span><span class="token punctuation">(</span><span class="token parameter">floatNum</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> ret <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">times</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">num</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
    <span class="token keyword">var</span> isNegative <span class="token operator">=</span> floatNum <span class="token operator">&lt;</span> <span class="token number">0</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isInteger</span><span class="token punctuation">(</span>floatNum<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ret<span class="token punctuation">.</span>num <span class="token operator">=</span> floatNum
      <span class="token keyword">return</span> ret
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> strfi <span class="token operator">=</span> floatNum <span class="token operator">+</span> <span class="token string">&quot;&quot;</span>
    <span class="token keyword">var</span> dotPos <span class="token operator">=</span> strfi<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> len <span class="token operator">=</span> strfi<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>dotPos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length
    <span class="token keyword">var</span> times <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span>
    <span class="token keyword">var</span> intNum <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>floatNum<span class="token punctuation">)</span> <span class="token operator">*</span> times <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
    ret<span class="token punctuation">.</span>times <span class="token operator">=</span> times
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isNegative<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      intNum <span class="token operator">=</span> <span class="token operator">-</span>intNum
    <span class="token punctuation">}</span>
    ret<span class="token punctuation">.</span>num <span class="token operator">=</span> intNum
    <span class="token keyword">return</span> ret
  <span class="token punctuation">}</span>

  <span class="token comment">/*
   * 核心方法，实现加减乘除运算，确保不丢失精度
   * 思路：把小数放大为整数（乘），进行算术运算，再缩小为小数（除）
   *
   * @param a {number} 运算数1
   * @param b {number} 运算数2
   * @param digits {number} 精度，保留的小数点数，比如 2, 即保留为两位小数
   * @param op {string} 运算类型，有加减乘除（add/subtract/multiply/divide）
   *
   */</span>
  <span class="token keyword">function</span> <span class="token function">operation</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> digits<span class="token punctuation">,</span> op</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> o1 <span class="token operator">=</span> <span class="token function">toInteger</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token keyword">var</span> o2 <span class="token operator">=</span> <span class="token function">toInteger</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
    <span class="token keyword">var</span> n1 <span class="token operator">=</span> o1<span class="token punctuation">.</span>num
    <span class="token keyword">var</span> n2 <span class="token operator">=</span> o2<span class="token punctuation">.</span>num
    <span class="token keyword">var</span> t1 <span class="token operator">=</span> o1<span class="token punctuation">.</span>times
    <span class="token keyword">var</span> t2 <span class="token operator">=</span> o2<span class="token punctuation">.</span>times
    <span class="token keyword">var</span> max <span class="token operator">=</span> t1 <span class="token operator">&gt;</span> t2 <span class="token operator">?</span> t1 <span class="token operator">:</span> t2
    <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>op<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">&quot;add&quot;</span><span class="token operator">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>t1 <span class="token operator">===</span> t2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 两个小数位数相同</span>
          result <span class="token operator">=</span> n1 <span class="token operator">+</span> n2
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>t1 <span class="token operator">&gt;</span> t2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// o1 小数位 大于 o2</span>
          result <span class="token operator">=</span> n1 <span class="token operator">+</span> n2 <span class="token operator">*</span> <span class="token punctuation">(</span>t1 <span class="token operator">/</span> t2<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// o1 小数位 小于 o2</span>
          result <span class="token operator">=</span> n1 <span class="token operator">*</span> <span class="token punctuation">(</span>t2 <span class="token operator">/</span> t1<span class="token punctuation">)</span> <span class="token operator">+</span> n2
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> result <span class="token operator">/</span> max
      <span class="token keyword">case</span> <span class="token string">&quot;subtract&quot;</span><span class="token operator">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>t1 <span class="token operator">===</span> t2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          result <span class="token operator">=</span> n1 <span class="token operator">-</span> n2
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>t1 <span class="token operator">&gt;</span> t2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          result <span class="token operator">=</span> n1 <span class="token operator">-</span> n2 <span class="token operator">*</span> <span class="token punctuation">(</span>t1 <span class="token operator">/</span> t2<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          result <span class="token operator">=</span> n1 <span class="token operator">*</span> <span class="token punctuation">(</span>t2 <span class="token operator">/</span> t1<span class="token punctuation">)</span> <span class="token operator">-</span> n2
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> result <span class="token operator">/</span> max
      <span class="token keyword">case</span> <span class="token string">&quot;multiply&quot;</span><span class="token operator">:</span>
        result <span class="token operator">=</span> <span class="token punctuation">(</span>n1 <span class="token operator">*</span> n2<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>t1 <span class="token operator">*</span> t2<span class="token punctuation">)</span>
        <span class="token keyword">return</span> result
      <span class="token keyword">case</span> <span class="token string">&quot;divide&quot;</span><span class="token operator">:</span>
        result <span class="token operator">=</span> <span class="token punctuation">(</span>n1 <span class="token operator">/</span> n2<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>t2 <span class="token operator">/</span> t1<span class="token punctuation">)</span>
        <span class="token keyword">return</span> result
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 加减乘除的四个接口</span>
  <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> digits</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">operation</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> digits<span class="token punctuation">,</span> <span class="token string">&quot;add&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">subtract</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> digits</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">operation</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> digits<span class="token punctuation">,</span> <span class="token string">&quot;subtract&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> digits</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">operation</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> digits<span class="token punctuation">,</span> <span class="token string">&quot;multiply&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">divide</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> digits</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">operation</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> digits<span class="token punctuation">,</span> <span class="token string">&quot;divide&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">add</span><span class="token operator">:</span> add<span class="token punctuation">,</span>
    <span class="token literal-property property">subtract</span><span class="token operator">:</span> subtract<span class="token punctuation">,</span>
    <span class="token literal-property property">multiply</span><span class="token operator">:</span> multiply<span class="token punctuation">,</span>
    <span class="token literal-property property">divide</span><span class="token operator">:</span> divide<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;floatObj.add(0.1, 0.2)&quot;</span><span class="token punctuation">,</span> floatObj<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">$$</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  e<span class="token punctuation">.</span>style<span class="token punctuation">.</span>border <span class="token operator">=</span> <span class="token string">&quot;1px solid&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/various/js-浏览器渲染原理.html" class="prev">
        浏览器渲染核心
      </a></span> <span class="next"><a href="/various/js-输入框之表情替换.html">
        输入框之表情替换
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.30386755.js" defer></script><script src="/assets/js/2.1d87707d.js" defer></script><script src="/assets/js/32.4ba9178d.js" defer></script>
  </body>
</html>
